## 项目简介

一个基于浏览器的「PDF 表单批量自动填充」工具。通过上传 Excel（`.xlsx`）数据与带有表单字段的 PDF 模板，自动将每行数据映射到 PDF 表单字段中，并生成成品 PDF 文件。支持文本字段、签名字段（图片或文字）、复选框等类型，并提供并发生成、错误跳过、表单扁平化及自定义导出文件名等功能。

仅在支持 File System Access API 的现代浏览器上可用（Chrome/Edge ≥ 86，Opera ≥ 72）。

## 主要功能

- 批量填充 PDF 表单：从 Excel 读取数据行，映射到 PDF 模板的表单字段。
- 字段类型支持：`文本`、`签名`、`复选框`（其他类型会被识别但当前不处理）。
- 签名填充：
  - 图片签名：Excel 单元格填入 `file://文件名`，自动从所选图片目录内读取 JPG/PNG 并填充到签名框。
  - 文字签名：Excel 单元格为普通文字时，需上传自定义字体以渲染文字到签名框（自动居中并适配大小）。
- 自定义导出文件名：可选择 Excel 的某一列作为导出的 PDF 文件名；默认使用行索引。
- 范围选择与并发生成：支持选择生成范围，内部已优化并发生成与并发写入。
- 错误处理：可选择“跳过错误”继续批量生成。
- 表单扁平化：生成后可将表单内容扁平化（不可编辑）。
- 运行日志：内置日志抽屉，生成过程可视化输出。

## 环境要求

- 浏览器：Chrome 或 Edge（≥ 86），Opera（≥ 72）。
- Node.js ≥ 18（本地开发和构建）。
- 包管理器：`pnpm`。

## 安装与运行

```bash
# 使用包管理器安装依赖
pnpm install

# 开发模式（端口 3000）
pnpm run dev

# 构建生产包
pnpm run build
```

打开浏览器访问 `http://localhost:3000` 即可使用。

## 使用指南

1. 上传 Excel（`.xlsx`）数据文件：
   - 工具会将第一行识别为“表头”，从第二行开始作为数据行读取。
   - 若某表头单元格为空，会自动用列名（A/B/C…）代替。
2. 上传 PDF 模板（需包含 AcroForm 表单字段）：
   - 页面会显示模板中的所有字段名称，便于对照。
   - Excel 的“表头”需与 PDF 字段名一致，才能正确映射。
3. 选择工作目录（写入生成的 PDF 文件）：
   - 将在此目录下创建导出的 PDF 文件。
4.（可选）选择图片目录：
   - 用于“图片签名”模式从目录中读取图片（仅 PNG/JPG）。
5.（可选）上传自定义字体：
   - 支持 `.ttf/.otf/.woff/.woff2`，用于：
     - 渲染中文、日文等非拉丁字符到文本字段。
     - 在“文字签名”模式下绘制签名内容。
6. 设置生成选项：
   - 索引范围：通过双滑块选择起止范围，或点击“首项/尾项”快速设置。
   - 跳过错误：生成或写入遇到错误时跳过该文件继续执行。
   - 扁平化表单：将表单内容固化为不可编辑文本/图像。
   - 导出文件名称：可选择某列作为导出的文件名（默认使用行索引）。
7. 点击“生成一份”或“批量生成”开始导出。

## 字段映射与规则

- 文本字段（`PDFTextField`）
  - 直接使用 Excel 对应单元格内容填充。
- 签名字段（`PDFSignature`）
  - 图片签名：单元格内容以 `file://` 开头（例如 `file://sign.png`），工具会从“图片目录”中读取该文件并填充到签名框，按框大小铺满。
  - 文字签名：单元格为普通文本时，需要先上传自定义字体，否则会报错；工具会居中绘制，并根据签名框尺寸自动调整字号。
- 复选框（`PDFCheckBox`）
  - 以下值视为“勾选”：`true`、`1`、`yes`、`是`；其它值则取消勾选。
- 其它字段类型（`PDFButton`、`PDFOptionList`、`PDFRadioGroup`、`PDFDropdown`）
  - 会被识别但当前未进行填充处理。

## 导出命名规则

- 默认文件名为序号（从 1 开始），扩展名 `.pdf`。
- 若选择某列作为导出文件名，则使用该列对应数据值加 `.pdf`。
- 请确保该列的内容适合作为文件名（避免空值、非法字符）。

## 示例数据与模板

仓库提供了示例文件（位于 `public/`）：

- 字体示例：`Arial Unicode MS.TTF`

你可以使用这些示例快速验证功能。

## 常见问题 FAQ

- 为什么只能在 Chrome/Edge 新版本使用？
  - 工具依赖 File System Access API 选择目录并写入文件，旧版浏览器不支持。
- 中文或特殊字符显示为方框/乱码？
  - 请上传支持目标字符的自定义字体（例如仓库中的 `Arial Unicode MS.TTF`）。
- 图片签名填充失败？
  - 确认 Excel 单元格采用 `file://文件名` 形式，且图片位于你选择的“图片目录”内，并且格式为 PNG/JPG。
- 导出文件名出现重复或非法字符？
  - 建议在 Excel 中预处理该列数据（去重、替换非法字符）。

## 构建与部署

- 构建命令：`pnpm run build`，产物输出到 `dist/`。
- 本项目使用 `vite-plugin-singlefile`，可将资源合并为单文件，适于静态托管（例如 Netlify、Surge、Vercel）。

## 开发提示

- 开发端口为 `3000`，可在 `vite.config.ts` 中修改。
- 页面右下角会显示构建时间（生产环境）。
- 日志面板可在右侧“日志”按钮中打开，用于查看生成过程详细信息。